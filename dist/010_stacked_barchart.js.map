{"version":3,"sources":["../010_stacked_barchart.js"],"names":["svgWidth","svgHeight","svg","d3","select","attr","margin","top","right","bottom","left","width","height","g","append","x","scaleBand","rangeRound","paddingInner","align","y","scaleLinear","z","scaleOrdinal","range","csv","d","i","columns","t","length","total","then","keys","data","slice","domain","map","State","max","nice","selectAll","stack","enter","key","bandwidth","call","axisBottom","remove","axisLeft","ticks","legend","reverse","text"],"mappings":"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","file":"010_stacked_barchart.js","sourcesContent":["/*\n*  Reference: https://bl.ocks.org/mbostock/3886208\n*\n* */\n\nconst svgWidth = 960;\nconst svgHeight = 500;\n\nconst svg = d3.select(\"svg\")\n    .attr(\"width\", svgWidth)\n    .attr(\"height\", svgHeight);\n\nconst margin = {top: 20, right: 20, bottom: 30, left: 50};\nconst width = svgWidth - margin.left - margin.right;\nconst height = svgHeight - margin.top - margin.bottom;\nconst g = svg.append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\nconst x = d3.scaleBand()\n    .rangeRound([0,width])\n    .paddingInner(0.05)\n    .align(0.1);\n\nconst y = d3.scaleLinear()\n    .rangeRound([height, 0]);\n\nconst z = d3.scaleOrdinal()\n    .range([\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\",\n        \"#a05d56\", \"#d0743c\", \"#ff8c00\"]);\n\n\nd3.csv(\"tsv/data_010_stacked_barchart.csv\", (d,i,columns) => {\n\n    var i = 1;\n    var t = 0;\n    for (; i < columns.length; ++i)\n        t += d[columns[i]] = +d[columns[i]];\n    d.total = t;\n    return d;\n\n}).then( data => {\n\n    const keys = data.columns.slice(1); // ignore the first item\n\n    x.domain( data.map ( d => d.State ));\n    y.domain([0, d3.max(data, d => d.total )]).nice();\n    z.domain(keys);\n\n    //console.log( data) ;\n    //console.log( keys) ;\n    //console.log( d3.stack().keys(keys)(data) );\n\n    // stacked bars\n    g.append(\"g\")\n        .selectAll(\"g\")\n        .data(d3.stack().keys(keys)(data))\n        .enter().append(\"g\")\n        .attr(\"fill\", d => z(d.key) )\n        .selectAll(\"rect\")\n        .data(d => d)\n        .enter().append(\"rect\")\n        .attr(\"x\",  d => x(d.data.State) )\n        .attr(\"y\", d => y(d[1]) )\n        .attr(\"height\", d => y(d[0]) - y(d[1]) )\n        .attr(\"width\", x.bandwidth());\n\n\n    // x-axis\n    g.append(\"g\")\n        .attr(\"class\", \"axis\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        .call(d3.axisBottom(x))\n        .select(\".domain\")\n        .remove();\n    \n    // y-axis\n    g.append(\"g\")\n        .attr(\"class\", \"axis\")\n        .call(d3.axisLeft(y).ticks(null, \"s\"));\n\n    // legend\n    const legend = g.append(\"g\")\n        .attr(\"font-family\", \"sans-serif\")\n        .attr(\"font-size\", 10)\n        .attr(\"text-anchor\", \"end\")\n        .selectAll(\"g\")\n        .data(keys.slice().reverse())\n        .enter().append(\"g\")\n        .attr(\"transform\", (d, i) => \"translate(0,\" + i * 20 + \")\");\n\n    legend.append(\"rect\")\n        .attr(\"x\", width - 19)\n        .attr(\"width\", 19)\n        .attr(\"height\", 19)\n        .attr(\"fill\", z);\n\n    legend.append(\"text\")\n        .attr(\"x\", width - 24)\n        .attr(\"y\", 9.5)\n        .attr(\"dy\", \"0.32em\")\n        .text(d => d);\n\n\n\n});\n\n\n"]}